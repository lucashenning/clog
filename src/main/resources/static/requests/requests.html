<div ng-controller="requests" ng-cloak class="ng-cloak">
<h1>Requests</h1>
<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>

<section>
    <div class="input-group">
        <input type="text" ng-model="search" class="search-query pull-left form-control" placeholder="Suche...">
        <span class="input-group-btn"><button class="btn btn-default" type="button">Go!</button></span>
        <button ng-click="openModal()" class="btn btn-primary pull-right"><i class="icon-white icon-plus"></i> Request hinzuf√ºgen</button>
    </div>
</section>

<table ng-table="tableParams" class="table table-hover">
    <thead>
    <tr>
        <th></th>
        <th>Status</th>
        <th>Initiator</th>
        <th>Created</th>
        <th>Zeitraum</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody ng-repeat="request in requests | filter:search | orderBy:'timestamp'" data-toggle="collapse" data-target="#{{request.id}}" class="accordion-toggle">
    <tr >
        <td><i class="glyphicon glyphicon glyphicon-triangle-right" aria-hidden="true"></i></td>
        <td data-title="'Status'">
            <progressbar ng-show="request.status == 1" class="progress" value="getApprovals(request)" max="3" type="warning">{{getApprovals(request)}} / 3</progressbar>
            <progressbar ng-show="request.status == 2" class="progress" value="" max="100" type="success">Approved...</progressbar>
        </td>
        <td data-title="'Initiator'">{{request.initiator['username']}}</td>
        <td data-title="'Created'">{{request.timestamp | date:"dd.MM.yyyy"}}</td>
        <td data-title="'Zeitraum'">{{request.startDate | date:"dd.MM.yyyy"}} bis {{request.endDate | date:"dd.MM.yyyy"}}</td>
        <td data-title="'Actions'">
            <a href="" ng-show="request.initiator['username'] != username && request.status == 1" ng-click="approve(request)" class="btn btn-success btn-xs" >Approve</a>
            <a href="" ng-show="request.initiator['username'] == username" ng-click="openModal(request)" class="btn btn-primary btn-xs" >Edit</a>
            <a href="" ng-show="request.initiator['username'] == username" ng-really-message="Do you really want to delete this request?" ng-really-click="removeRecord($index)" class="btn btn-default btn-xs" >Delete</a>
        </td>
    </tr>
    <tr>
        <td colspan="1" class="hiddenRow"></td>
        <td colspan="5" class="hiddenRow"><div class="accordion-body collapse" id="{{request.id}}">
            <div class="row">
                <div class="col-sm-3"><b>ID:</b><p>{{request.id}}</p></div>
                <div class="col-sm-3"><b>Approvals:</b><p ng-repeat="approval in request.approvals">{{approval.approver['username']}} ({{approval.timestamp | date:"dd.MM.yyyy"}})</p></div>
                <div class="col-sm-3"><b>Comment:</b><p>{{request.comment}}</p></div>
            </div>
        </div></td>
    </tr>
    <script>

    </script>

    </tbody>
</table>
</div>